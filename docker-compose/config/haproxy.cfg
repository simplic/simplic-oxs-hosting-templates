##based on Mesosphere Marathon's servicerouter.py haproxy config

global
  daemon
  log 127.0.0.1 local0
  log 127.0.0.1 local1 notice
  maxconn 4096
  tune.ssl.default-dh-param 2048

defaults
  log               global
  retries           3
  maxconn           2000
  timeout connect   5s
  timeout client    50s
  timeout server    50s

frontend fe_oxs_auth_service
    bind 0.0.0.0:8080

    mode http

    acl oxs_auth_service path_beg -i /v1/auth-api
    use_backend bk_oxs_auth_service if oxs_auth_service

backend bk_oxs_auth_service
    mode http
    server simplic_auth simplic_auth:80

#frontend fe_signoz
#    bind 0.0.0.0:8080
#
#    mode http
#
#    acl signoz path_beg -i /signoz
#    use_backend bk_signoz if signoz
#
#backend bk_signoz
#    mode http
#    http-request set-path "%[path,regsub(^/signoz/,/)]"
#    server signoz signoz:3301

